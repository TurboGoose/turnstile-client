import face_recognition
import numpy as np

from cloud.storage import FacesDatabase

db = FacesDatabase(image_folder="../faces")
known_face_ids, known_face_encodings = db.get_all_faces()


def find_best_match(face_encoding):
    matches = face_recognition.compare_faces(known_face_encodings, face_encoding)
    face_distances = face_recognition.face_distance(known_face_encodings, face_encoding)
    best_match_index = np.argmin(face_distances)

    if not matches[best_match_index]:
        return

    best_match_id = known_face_ids[best_match_index]
    credentials = db.get_info_by_id(best_match_id)

    return credentials


if __name__ == '__main__':
    lst = [-0.10443348, 0.06352623, 0.02680163, -0.105592, -0.00843665,
           0.02660548, 0.01249716, -0.00327516, 0.18414439, -0.09832314,
           0.29003462, -0.03880362, -0.31808659, -0.09330009, 0.01796481,
           0.11493798, -0.17255537, -0.13334782, -0.03067506, -0.03758535,
           0.16593084, 0.02190376, -0.07887708, 0.06736697, -0.19666609,
           -0.29181686, -0.06175144, -0.12025882, -0.02262344, -0.14310156,
           0.0883515, 0.07590225, -0.13584849, -0.03628118, 0.0095723,
           0.05767116, -0.07769726, -0.03910432, 0.22866702, 0.08068642,
           -0.13873111, 0.01643692, 0.02416644, 0.34175557, 0.10099794,
           0.07565219, 0.01875301, -0.03681186, 0.11583281, -0.33426672,
           -0.03616339, 0.22260608, 0.139944, 0.13499902, 0.10187228,
           -0.18397944, 0.06673238, 0.1002534, -0.25887737, 0.0950432,
           -0.01622259, -0.06471823, 0.04370064, -0.06639516, 0.17942075,
           0.00473196, -0.1660706, -0.05482922, 0.12471809, -0.10156558,
           -0.11652534, 0.1161337, -0.16384646, -0.24687585, -0.26948971,
           0.04785857, 0.32237083, 0.18341286, -0.15827546, 0.02120167,
           -0.04714224, -0.03744044, 0.01250403, 0.04976575, -0.05058238,
           -0.0240621, -0.0530466, 0.03523022, 0.16062002, -0.01329695,
           0.00098873, 0.24698128, 0.02919833, 0.02615084, -0.01292194,
           0.01063304, -0.0849367, -0.02165054, -0.10378361, -0.01566011,
           -0.02323069, -0.09264922, 0.02540858, 0.09888826, -0.22845308,
           0.18935052, 0.01066783, -0.06688221, -0.11003058, 0.06059621,
           -0.1259411, 0.05418809, 0.12151891, -0.30274072, 0.19567525,
           0.26578286, 0.07954025, 0.10388766, 0.07046545, -0.02003738,
           -0.04152751, -0.0417005, -0.16584632, -0.12726778, 0.03797548,
           0.02623694, 0.02862751, -0.03819616]
    encoding = np.array(lst, dtype=np.float32)
    creds = find_best_match(encoding)
    print(creds)
